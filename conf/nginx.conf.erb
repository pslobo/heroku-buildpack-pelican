daemon off;
worker_processes 4;

events {
  use epoll;
  worker_connections 1024;
}

http {
  sendfile on;
  tcp_nopush on;
  tcp_nodelay on;

  gzip_static on;
  <!-- gzip_disable "msie6"; -->
  gzip_comp_level 6;
  gzip_min_length 1100;
  <!-- gzip_buffers 16 8k; -->
  gzip_proxied any;
  gzip_types text/plain text/css text/js text/xml text/javascript application/javascript application/x-javascript application/json application/xml application/xml+rss;

  include mime.types;

 <% if ENV["PELICAN_SITEURL"] %>
  server {
    listen <%= ENV["PORT"] %>;
    rewrite ^(.*) <%= ENV["PELICAN_SITEURL"] %>$1 permanent;
  }
 <% end %>

  server {
    listen <%= ENV["PORT"] %>;
    port_in_redirect off;
    root /app/public;
  <% if ENV["PELICAN_SITEURL"] %>
    server_name <%= require 'uri'; URI.parse(ENV["PELICAN_SITEURL"]).host %>;
  <% end %>

    location / {
      expires 10s;
    }
  }
}

